<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Walkerbay POS Mobile</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Cormorant+Garamond:wght@600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        deepBlue: '#002B5B',
                        softWhite: '#F3F4F6',
                        accentGold: '#C5A059',
                    },
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                        serif: ['Cormorant Garamond', 'serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* Mobile Optimizations */
        body { -webkit-tap-highlight-color: transparent; }
        
        /* Hide Scrollbar but keep functionality */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Animation */
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Receipt Print Styling */
        @media print {
            body * { visibility: hidden; }
            #receipt-content, #receipt-content * { visibility: visible; }
            #receipt-modal { position: absolute; left: 0; top: 0; width: 100%; height: auto; background: white; z-index: 9999; }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 h-screen flex flex-col overflow-hidden font-sans select-none">

    <!-- 1. MOBILE HEADER -->
    <header class="bg-deepBlue text-white h-16 flex items-center justify-between px-4 shadow-md shrink-0 z-30">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-accentGold rounded-full flex items-center justify-center text-deepBlue font-bold font-serif">W</div>
            <div>
                <h1 class="font-serif text-lg leading-none">Walkerbay</h1>
                <p class="text-[10px] text-gray-300 uppercase tracking-widest">POS System</p>
            </div>
        </div>
        <div class="text-right">
            <div id="clock" class="text-xs font-mono bg-white/10 px-2 py-1 rounded">00:00</div>
        </div>
    </header>

    <!-- 2. MAIN CONTENT AREA -->
    <main class="flex-1 overflow-hidden relative">
        
        <!-- VIEW: REGISTER (PRODUCTS) -->
        <div id="view-register" class="h-full flex flex-col fade-in">
            <!-- Categories -->
            <div class="bg-white shadow-sm p-2 overflow-x-auto no-scrollbar flex gap-2 shrink-0 z-20">
                <button onclick="filterProducts('all')" class="cat-btn active bg-deepBlue text-white px-5 py-2 rounded-full text-xs font-bold uppercase whitespace-nowrap transition">All</button>
                <button onclick="filterProducts('accommodation')" class="cat-btn bg-gray-100 text-gray-600 px-5 py-2 rounded-full text-xs font-bold uppercase whitespace-nowrap transition">Rooms</button>
                <button onclick="filterProducts('food')" class="cat-btn bg-gray-100 text-gray-600 px-5 py-2 rounded-full text-xs font-bold uppercase whitespace-nowrap transition">Food</button>
                <button onclick="filterProducts('excursion')" class="cat-btn bg-gray-100 text-gray-600 px-5 py-2 rounded-full text-xs font-bold uppercase whitespace-nowrap transition">Tours</button>
            </div>

            <!-- Product Grid -->
            <div id="product-grid" class="flex-1 overflow-y-auto p-3 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3 pb-24">
                <!-- Products injected via JS -->
            </div>
        </div>

        <!-- VIEW: HISTORY -->
        <div id="view-history" class="h-full hidden fade-in bg-white flex-col">
            <div class="p-4 border-b border-gray-100 flex justify-between items-center">
                <h2 class="font-serif text-2xl text-deepBlue">Sales History</h2>
                <button onclick="clearData()" class="text-red-500 text-xs uppercase font-bold">Reset Data</button>
            </div>
            <div id="history-list" class="flex-1 overflow-y-auto p-4 space-y-3 pb-24">
                <!-- Transactions injected via JS -->
            </div>
        </div>

    </main>

    <!-- 3. FLOATING CART BAR (Mobile Bottom) -->
    <div id="mobile-cart-bar" onclick="openCartModal()" class="fixed bottom-20 left-4 right-4 bg-deepBlue text-white p-4 rounded-xl shadow-2xl flex justify-between items-center transform translate-y-32 transition-transform duration-300 z-40 cursor-pointer">
        <div class="flex items-center gap-3">
            <div class="bg-accentGold text-deepBlue w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm" id="cart-count-float">0</div>
            <span class="text-sm font-medium">View Current Order</span>
        </div>
        <div class="font-bold text-lg" id="cart-total-float">KSh 0</div>
    </div>

    <!-- 4. BOTTOM NAVIGATION -->
    <nav class="bg-white border-t border-gray-200 h-16 flex justify-around items-center shrink-0 z-50 pb-safe">
        <button onclick="switchView('register')" class="nav-btn text-deepBlue flex flex-col items-center gap-1 w-full h-full justify-center active:bg-gray-50">
            <i class="fas fa-cash-register text-xl"></i>
            <span class="text-[10px] font-bold uppercase">Sale</span>
        </button>
        <button onclick="switchView('history')" class="nav-btn text-gray-400 flex flex-col items-center gap-1 w-full h-full justify-center active:bg-gray-50">
            <i class="fas fa-history text-xl"></i>
            <span class="text-[10px] font-bold uppercase">History</span>
        </button>
    </nav>

    <!-- 5. CART MODAL (Full Screen Overlay) -->
    <div id="cart-modal" class="fixed inset-0 bg-gray-900/50 backdrop-blur-sm z-[60] hidden flex justify-end">
        <div class="bg-white w-full md:w-[400px] h-full shadow-2xl flex flex-col animate-slide-in">
            <!-- Cart Header -->
            <div class="p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                <h3 class="font-serif text-xl text-deepBlue">Current Order</h3>
                <button onclick="closeCartModal()" class="w-8 h-8 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center"><i class="fas fa-times"></i></button>
            </div>

            <!-- Cart Items -->
            <div id="cart-items-container" class="flex-1 overflow-y-auto p-4 space-y-4">
                <!-- Items -->
            </div>

            <!-- Cart Footer -->
            <div class="p-6 bg-white border-t border-gray-100 shadow-[0_-5px_15px_rgba(0,0,0,0.05)]">
                <div class="flex justify-between mb-4 text-xl font-bold text-deepBlue">
                    <span>Total</span>
                    <span id="cart-modal-total">KSh 0</span>
                </div>
                
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <button onclick="setPayment('CASH')" id="btn-cash" class="pay-method active py-3 border-2 border-deepBlue bg-deepBlue text-white rounded-lg text-xs font-bold uppercase">Cash</button>
                    <button onclick="setPayment('MPESA')" id="btn-mpesa" class="pay-method py-3 border-2 border-gray-200 text-gray-500 rounded-lg text-xs font-bold uppercase">M-Pesa</button>
                </div>

                <button onclick="processSale()" class="w-full bg-accentGold text-white py-4 rounded-xl font-bold uppercase tracking-widest text-sm shadow-lg active:scale-95 transition">
                    Complete Sale
                </button>
            </div>
        </div>
    </div>

    <!-- 6. PROCESSING OVERLAY -->
    <div id="processing-overlay" class="fixed inset-0 bg-deepBlue/90 z-[70] hidden flex flex-col items-center justify-center text-white">
        <div class="w-16 h-16 border-4 border-white/30 border-t-accentGold rounded-full animate-spin mb-6"></div>
        <h3 class="text-xl font-serif">Processing Transaction...</h3>
        <p class="text-sm opacity-70 mt-2">Please wait</p>
    </div>

    <!-- 7. RECEIPT MODAL -->
    <div id="receipt-modal-view" class="fixed inset-0 z-[80] hidden flex items-center justify-center bg-black/80 p-4">
        <div class="bg-white w-full max-w-sm rounded-lg shadow-2xl overflow-hidden">
            <div class="p-4 bg-green-500 text-white text-center">
                <i class="fas fa-check-circle text-4xl mb-2"></i>
                <h3 class="font-bold text-lg">Sale Successful!</h3>
            </div>
            
            <!-- Receipt Content (Printable) -->
            <div id="receipt-content" class="p-6 bg-white text-xs font-mono text-gray-600 leading-relaxed">
                <div class="text-center mb-4">
                    <h2 class="font-bold text-lg text-black uppercase mb-1">Walkerbay Hotels</h2>
                    <p>Muhuru Bay, Kenya</p>
                    <p>Tel: +254 700 346 672</p>
                </div>
                <div class="border-b border-dashed border-gray-300 my-2"></div>
                <div class="flex justify-between">
                    <span id="rec-date"></span>
                    <span id="rec-time"></span>
                </div>
                <div class="flex justify-between mb-2">
                    <span>Receipt #:</span>
                    <span id="rec-id" class="font-bold text-black"></span>
                </div>
                <div class="border-b border-dashed border-gray-300 my-2"></div>
                
                <table class="w-full text-left mb-2">
                    <thead><tr class="text-black"><th class="w-1/2">Item</th><th class="text-center">Qty</th><th class="text-right">Amt</th></tr></thead>
                    <tbody id="rec-items"></tbody>
                </table>
                
                <div class="border-t border-dashed border-gray-300 mt-2 pt-2">
                    <div class="flex justify-between text-base font-bold text-black">
                        <span>TOTAL</span>
                        <span id="rec-total"></span>
                    </div>
                    <div class="flex justify-between mt-1">
                        <span>Paid via:</span>
                        <span id="rec-method"></span>
                    </div>
                </div>
                <div class="text-center mt-6 italic">
                    Served by: Victor Olal<br>
                    Thank you for your visit!
                </div>
            </div>

            <div class="p-4 bg-gray-50 flex gap-3 no-print">
                <button onclick="window.print()" class="flex-1 bg-deepBlue text-white py-3 rounded-lg font-bold text-sm">Print</button>
                <button onclick="closeReceipt()" class="flex-1 border border-gray-300 text-gray-600 py-3 rounded-lg font-bold text-sm">New Sale</button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- DATA ---
        const products = [
            { id: 1, name: "Standard Room", category: "accommodation", price: 1500, icon: "fa-bed" },
            { id: 2, name: "Suite Room", category: "accommodation", price: 2000, icon: "fa-gem" },
            { id: 3, name: "Bed Only Package", category: "accommodation", price: 6000, icon: "fa-box" },
            { id: 4, name: "Light Lunch", category: "food", price: 300, icon: "fa-sandwich" },
            { id: 5, name: "Breakfast Buffet", category: "food", price: 500, icon: "fa-coffee" },
            { id: 6, name: "Lunch/Dinner Buffet", category: "food", price: 800, icon: "fa-utensils" },
            { id: 7, name: "Soda/Water", category: "food", price: 100, icon: "fa-bottle-water" },
            { id: 8, name: "Speedboat Ride", category: "excursion", price: 1500, icon: "fa-ship" },
            { id: 9, name: "Caves Tour", category: "excursion", price: 500, icon: "fa-mountain" },
            { id: 10, name: "Island Trip", category: "excursion", price: 1000, icon: "fa-map" },
        ];

        let cart = [];
        let paymentType = 'CASH';
        let transactions = JSON.parse(localStorage.getItem('wb_sales')) || [];

        // --- INIT ---
        window.onload = () => {
            renderProducts('all');
            renderHistory();
            updateClock();
            setInterval(updateClock, 1000);
        };

        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }

        // --- NAVIGATION & VIEWS ---
        function switchView(viewName) {
            document.getElementById('view-register').classList.add('hidden');
            document.getElementById('view-history').classList.add('hidden');
            document.getElementById('view-history').classList.remove('flex'); // remove flex for history
            
            // Reset Nav Buttons
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.replace('text-deepBlue', 'text-gray-400'));
            
            if(viewName === 'register') {
                document.getElementById('view-register').classList.remove('hidden');
                event.currentTarget.classList.replace('text-gray-400', 'text-deepBlue');
            } else {
                const historyView = document.getElementById('view-history');
                historyView.classList.remove('hidden');
                historyView.classList.add('flex');
                event.currentTarget.classList.replace('text-gray-400', 'text-deepBlue');
                renderHistory();
            }
        }

        function filterProducts(cat) {
            document.querySelectorAll('.cat-btn').forEach(b => {
                b.classList.remove('bg-deepBlue', 'text-white');
                b.classList.add('bg-gray-100', 'text-gray-600');
            });
            event.target.classList.remove('bg-gray-100', 'text-gray-600');
            event.target.classList.add('bg-deepBlue', 'text-white');
            renderProducts(cat);
        }

        function renderProducts(cat) {
            const grid = document.getElementById('product-grid');
            grid.innerHTML = '';
            const items = cat === 'all' ? products : products.filter(p => p.category === cat);
            
            items.forEach(p => {
                grid.innerHTML += `
                    <div onclick="addToCart(${p.id})" class="bg-white p-3 rounded-xl shadow-sm border border-gray-100 active:scale-95 transition cursor-pointer flex flex-col justify-between h-32 relative overflow-hidden group">
                        <div class="absolute right-0 top-0 p-2 opacity-10 group-hover:opacity-20 transition">
                            <i class="fas ${p.icon} text-4xl text-deepBlue"></i>
                        </div>
                        <div class="font-bold text-sm text-deepBlue z-10 leading-tight">${p.name}</div>
                        <div class="z-10">
                            <span class="bg-green-100 text-green-700 text-[10px] font-bold px-2 py-1 rounded-full">KSh ${p.price.toLocaleString()}</span>
                        </div>
                    </div>
                `;
            });
        }

        // --- CART LOGIC ---
        function addToCart(id) {
            const prod = products.find(p => p.id === id);
            const exists = cart.find(c => c.id === id);
            if(exists) exists.qty++;
            else cart.push({...prod, qty: 1});
            updateCartUI();
        }

        function updateCartUI() {
            // Update Floating Bar
            const total = cart.reduce((sum, i) => sum + (i.price * i.qty), 0);
            const count = cart.reduce((sum, i) => sum + i.qty, 0);
            
            document.getElementById('cart-count-float').innerText = count;
            document.getElementById('cart-total-float').innerText = `KSh ${total.toLocaleString()}`;
            
            const bar = document.getElementById('mobile-cart-bar');
            if(count > 0) bar.classList.remove('translate-y-32');
            else bar.classList.add('translate-y-32');
        }

        function openCartModal() {
            const modal = document.getElementById('cart-modal');
            const container = document.getElementById('cart-items-container');
            container.innerHTML = '';
            let total = 0;

            cart.forEach(item => {
                total += item.price * item.qty;
                container.innerHTML += `
                    <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg border border-gray-100">
                        <div>
                            <div class="font-bold text-deepBlue text-sm">${item.name}</div>
                            <div class="text-xs text-gray-500">@ ${item.price.toLocaleString()}</div>
                        </div>
                        <div class="flex items-center gap-3">
                            <button onclick="modQty(${item.id}, -1)" class="w-8 h-8 rounded bg-white border border-gray-200 text-gray-600 font-bold">-</button>
                            <span class="font-bold w-4 text-center text-sm">${item.qty}</span>
                            <button onclick="modQty(${item.id}, 1)" class="w-8 h-8 rounded bg-deepBlue text-white font-bold">+</button>
                        </div>
                    </div>
                `;
            });

            document.getElementById('cart-modal-total').innerText = `KSh ${total.toLocaleString()}`;
            modal.classList.remove('hidden');
        }

        function modQty(id, change) {
            const item = cart.find(i => i.id === id);
            item.qty += change;
            if(item.qty <= 0) cart = cart.filter(i => i.id !== id);
            updateCartUI();
            openCartModal(); // Re-render modal
            if(cart.length === 0) closeCartModal();
        }

        function closeCartModal() {
            document.getElementById('cart-modal').classList.add('hidden');
        }

        function setPayment(method) {
            paymentType = method;
            document.querySelectorAll('.pay-method').forEach(b => {
                b.classList.remove('bg-deepBlue', 'text-white', 'border-deepBlue');
                b.classList.add('border-gray-200', 'text-gray-500');
            });
            const activeBtn = method === 'CASH' ? document.getElementById('btn-cash') : document.getElementById('btn-mpesa');
            activeBtn.classList.remove('border-gray-200', 'text-gray-500');
            activeBtn.classList.add('bg-deepBlue', 'text-white', 'border-deepBlue');
        }

        // --- SALES PROCESSING ---
        function processSale() {
            closeCartModal();
            document.getElementById('processing-overlay').classList.remove('hidden');

            setTimeout(() => {
                // 1. Save Data
                const total = cart.reduce((s, i) => s + (i.price * i.qty), 0);
                const tx = {
                    id: 'WB' + Date.now().toString().slice(-6),
                    date: new Date().toISOString(),
                    items: [...cart],
                    total: total,
                    method: paymentType
                };
                transactions.unshift(tx);
                localStorage.setItem('wb_sales', JSON.stringify(transactions));

                // 2. Hide Loader
                document.getElementById('processing-overlay').classList.add('hidden');

                // 3. Populate Receipt Modal
                document.getElementById('rec-id').innerText = tx.id;
                document.getElementById('rec-date').innerText = new Date().toLocaleDateString();
                document.getElementById('rec-time').innerText = new Date().toLocaleTimeString();
                document.getElementById('rec-method').innerText = paymentType;
                document.getElementById('rec-total').innerText = `KSh ${total.toLocaleString()}`;
                
                const recItems = document.getElementById('rec-items');
                recItems.innerHTML = '';
                tx.items.forEach(i => {
                    recItems.innerHTML += `
                        <tr>
                            <td class="py-1 border-b border-gray-100">${i.name}</td>
                            <td class="py-1 text-center border-b border-gray-100">${i.qty}</td>
                            <td class="py-1 text-right border-b border-gray-100">${(i.price * i.qty).toLocaleString()}</td>
                        </tr>
                    `;
                });

                // 4. Show Receipt
                document.getElementById('receipt-modal-view').classList.remove('hidden');

                // 5. Clear Cart
                cart = [];
                updateCartUI();

            }, 2000); // 2 Second fake delay
        }

        function closeReceipt() {
            document.getElementById('receipt-modal-view').classList.add('hidden');
        }

        // --- HISTORY ---
        function renderHistory() {
            const container = document.getElementById('history-list');
            container.innerHTML = '';
            
            if(transactions.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 mt-10">No sales yet.</div>';
                return;
            }

            transactions.forEach(tx => {
                container.innerHTML += `
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-100 flex justify-between items-center">
                        <div>
                            <div class="font-bold text-deepBlue text-sm">#${tx.id}</div>
                            <div class="text-xs text-gray-500">${new Date(tx.date).toLocaleString()}</div>
                            <span class="text-[10px] bg-gray-100 px-2 py-0.5 rounded font-bold uppercase">${tx.method}</span>
                        </div>
                        <div class="font-bold text-green-600">
                            KSh ${tx.total.toLocaleString()}
                        </div>
                    </div>
                `;
            });
        }

        function clearData() {
            if(confirm("Delete all history?")) {
                localStorage.removeItem('wb_sales');
                transactions = [];
                renderHistory();
            }
        }
    </script>
</body>
</html>
